{% load static %}

<div class="modal-header border-bottom border-info py-3">
    <h5 class="modal-title text-white fw-normal">
        <i class="bi bi-person-gear me-2"></i>
        EDITAR CLIENTE
    </h5>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
</div>

<div class="modal-body p-4">
    <form id="clienteEditForm" method="post" enctype="multipart/form-data" novalidate>
        {% csrf_token %}
        <input type="hidden" name="_method" value="PUT">
        
        <!-- Línea decorativa superior -->
        <div class="position-absolute top-0 start-0 end-0" style="height: 3px; background: linear-gradient(90deg, #4a9fff, #2d70cc);"></div>

        <!-- Estado del Lead -->
        <div class="mb-5">
            <div class="d-flex align-items-center mb-4 gap-3">
                <div class="bg-info rounded-circle p-2 d-flex align-items-center">
                    <i class="bi bi-activity fs-5 text-white"></i>
                </div>
                <h5 class="text-info mb-0 text-uppercase fw-light letter-spacing-1">Estado del Lead</h5>
            </div>
            <div class="row g-4">
                <div class="col-12 col-md-6">
                    <div class="mb-4 position-relative">
                        <label for="{{ form.estado.id_for_label }}" class="form-label">
                            {{ form.estado.label }}<span class="text-danger">*</span>
                        </label>
                        {{ form.estado }}
                        {% if form.estado.errors %}
                            <div class="invalid-feedback">{{ form.estado.errors|first }}</div>
                        {% endif %}
                        <small class="form-text text-muted mt-1">Seleccione el estado actual del lead</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Datos Personales -->
        <div class="mb-5">
            <div class="d-flex align-items-center mb-4 gap-3">
                <div class="bg-info rounded-circle p-2 d-flex align-items-center">
                    <i class="bi bi-person-lines-fill fs-5 text-white"></i>
                </div>
                <h5 class="text-info mb-0 text-uppercase fw-light letter-spacing-1">Datos Personales</h5>
            </div>
            <div class="row g-4">
                <!-- Nombre y Apellido -->
                <div class="col-12 col-md-6">
                    <div class="mb-4 position-relative">
                        <label for="{{ form.nombre_apellido.id_for_label }}" class="form-label">
                            {{ form.nombre_apellido.label }}<span class="text-danger">*</span>
                        </label>
                        {{ form.nombre_apellido }}
                        {% if form.nombre_apellido.errors %}
                            <div class="invalid-feedback">{{ form.nombre_apellido.errors|first }}</div>
                        {% endif %}
                    </div>
                </div>

                <!-- Cédula/Pasaporte (solo lectura) -->
                <div class="col-12 col-md-6">
                    <div class="mb-4 position-relative">
                        <label for="{{ form.cedula_pasaporte.id_for_label }}" class="form-label">
                            {{ form.cedula_pasaporte.label }}<span class="text-danger">*</span>
                        </label>
                        {{ form.cedula_pasaporte }}
                        <small class="form-text text-warning mt-1 d-block">Este campo no puede ser modificado</small>
                        {% if form.cedula_pasaporte.errors %}
                            <div class="invalid-feedback">{{ form.cedula_pasaporte.errors|first }}</div>
                        {% endif %}
                    </div>
                </div>

                <!-- Fecha de Nacimiento -->
                <div class="col-12 col-md-6">
                    <div class="mb-4 position-relative">
                        <label for="{{ form.fecha_nacimiento.id_for_label }}" class="form-label">
                            {{ form.fecha_nacimiento.label }}<span class="text-danger">*</span>
                        </label>
                        {{ form.fecha_nacimiento }}
                        {% if form.fecha_nacimiento.errors %}
                            <div class="invalid-feedback">{{ form.fecha_nacimiento.errors|first }}</div>
                        {% endif %}
                    </div>
                </div>

                <!-- Nacionalidad -->
                <div class="col-12 col-md-6">
                    <div class="mb-4 position-relative">
                        <label for="{{ form.nacionalidad.id_for_label }}" class="form-label">
                            {{ form.nacionalidad.label }}<span class="text-danger">*</span>
                        </label>
                        {{ form.nacionalidad }}
                        {% if form.nacionalidad.errors %}
                            <div class="invalid-feedback">{{ form.nacionalidad.errors|first }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Datos Laborales -->
        <div class="mb-5">
            <div class="d-flex align-items-center mb-4 gap-3">
                <div class="bg-info rounded-circle p-2 d-flex align-items-center">
                    <i class="bi bi-building fs-5 text-white"></i>
                </div>
                <h5 class="text-info mb-0 text-uppercase fw-light letter-spacing-1">Datos Laborales</h5>
            </div>
            <div class="row g-4">
                <div class="col-12 col-md-6">
                    <div class="mb-4 position-relative">
                        <label for="{{ form.lugar_trabajo.id_for_label }}" class="form-label">
                            {{ form.lugar_trabajo.label }}
                        </label>
                        {{ form.lugar_trabajo }}
                        {% if form.lugar_trabajo.errors %}
                            <div class="invalid-feedback">{{ form.lugar_trabajo.errors|first }}</div>
                        {% endif %}
                        <small class="form-text text-muted mt-1">Ej: Nombre de la empresa u organización</small>
                    </div>
                </div>
                <div class="col-12 col-md-6">
                    <div class="mb-4 position-relative">
                        <label for="{{ form.cargo.id_for_label }}" class="form-label">
                            {{ form.cargo.label }}
                        </label>
                        {{ form.cargo }}
                        {% if form.cargo.errors %}
                            <div class="invalid-feedback">{{ form.cargo.errors|first }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Información de Contacto -->
        <div class="mb-5">
            <div class="d-flex align-items-center mb-4 gap-3">
                <div class="bg-info rounded-circle p-2 d-flex align-items-center">
                    <i class="bi bi-telephone-forward fs-5 text-white"></i>
                </div>
                <h5 class="text-info mb-0 text-uppercase fw-light letter-spacing-1">Contacto</h5>
            </div>
            <div class="row g-4">
                <!-- Email (solo lectura) -->
                <div class="col-12 col-md-6">
                    <div class="mb-4 position-relative">
                        <label for="{{ form.email.id_for_label }}" class="form-label">
                            {{ form.email.label }}<span class="text-danger">*</span>
                        </label>
                        <div class="input-group">
                            {{ form.email }}
                            <button type="button" class="btn btn-outline-info" disabled>
                                <i class="bi bi-x-circle"></i> N/A
                            </button>
                        </div>
                        <small class="form-text text-warning mt-1 d-block">Este campo no puede ser modificado</small>
                        {% if form.email.errors %}
                            <div class="invalid-feedback">{{ form.email.errors|first }}</div>
                        {% endif %}
                    </div>
                </div>

                <!-- Teléfono -->
                <div class="col-12 col-md-6">
                    <div class="mb-4 position-relative">
                        <label for="{{ form.telefono.id_for_label }}" class="form-label">
                            {{ form.telefono.label }}<span class="text-danger">*</span>
                        </label>
                        <div class="input-group">
                            {{ form.telefono }}
                            <button type="button" class="btn btn-outline-info" 
                                    onclick="document.getElementById('{{ form.telefono.id_for_label }}').value = 'N/A'">
                                <i class="bi bi-x-circle"></i> N/A
                            </button>
                        </div>
                        {% if form.telefono.errors %}
                            <div class="invalid-feedback">{{ form.telefono.errors|first }}</div>
                        {% endif %}
                        <small class="form-text text-muted mt-1">{{ form.telefono.help_text }}</small>
                    </div>
                </div>

                <!-- Móvil -->
                <div class="col-12 col-md-6">
                    <div class="mb-4 position-relative">
                        <label for="{{ form.movil.id_for_label }}" class="form-label">
                            {{ form.movil.label }}
                        </label>
                        <div class="input-group">
                            {{ form.movil }}
                            <button type="button" class="btn btn-outline-info" 
                                    onclick="document.getElementById('{{ form.movil.id_for_label }}').value = 'N/A'">
                                <i class="bi bi-x-circle"></i> N/A
                            </button>
                        </div>
                        {% if form.movil.errors %}
                            <div class="invalid-feedback">{{ form.movil.errors|first }}</div>
                        {% endif %}
                    </div>
                </div>

                <!-- Dirección -->
                <div class="col-12">
                    <div class="mb-4 position-relative">
                        <label for="{{ form.direccion_fisica.id_for_label }}" class="form-label">
                            {{ form.direccion_fisica.label }}<span class="text-danger">*</span>
                        </label>
                        {{ form.direccion_fisica }}
                        {% if form.direccion_fisica.errors %}
                            <div class="invalid-feedback">{{ form.direccion_fisica.errors|first }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Información Adicional -->
        <div class="mb-4">
            <div class="d-flex align-items-center mb-4 gap-3">
                <div class="bg-info rounded-circle p-2 d-flex align-items-center">
                    <i class="bi bi-info-square fs-5 text-white"></i>
                </div>
                <h5 class="text-info mb-0 text-uppercase fw-light letter-spacing-1">Información Adicional</h5>
            </div>
            <div class="row g-4">
                <div class="col-12">
                    <div class="mb-4 position-relative">
                        <label for="{{ form.documento.id_for_label }}" class="form-label">
                            <i class="bi bi-cloud-upload me-2"></i>{{ form.documento.label }}
                        </label>
                        {{ form.documento }}
                        {% if form.documento.errors %}
                            <div class="invalid-feedback">{{ form.documento.errors|first }}</div>
                        {% endif %}
                        <small class="form-text text-muted mt-1">{{ form.documento.help_text }}</small>
                    </div>
                </div>
                <div class="col-12">
                    <div class="mb-4 position-relative">
                        <label for="{{ form.notas.id_for_label }}" class="form-label">
                            {{ form.notas.label }}
                        </label>
                        {{ form.notas }}
                        {% if form.notas.errors %}
                            <div class="invalid-feedback">{{ form.notas.errors|first }}</div>
                        {% endif %}
                        <small class="form-text text-muted mt-1">Observaciones relevantes sobre el cliente</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal-footer border-top border-secondary px-4 pb-4 pt-3">
            <button type="button" class="btn btn-lg btn-outline-light" data-bs-dismiss="modal">
                <i class="bi bi-x-lg me-2"></i>Cancelar
            </button>
            <button type="submit" class="btn btn-lg btn-info fw-medium">
                <i class="bi bi-arrow-repeat me-2"></i>Actualizar Cliente
            </button>
        </div>
    </form>
</div>

<!-- Scripts -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    // Validación en tiempo real
    const setupRealTimeValidation = () => {
        document.querySelectorAll('input, select, textarea').forEach(field => {
            field.addEventListener('input', () => {
                if (field.checkValidity()) {
                    field.classList.remove('is-invalid');
                } else {
                    field.classList.add('is-invalid');
                }
            });
        });
    };

    // Limpiar errores al cerrar
    const clearErrors = () => {
        document.querySelectorAll('.is-invalid').forEach(field => {
            field.classList.remove('is-invalid');
        });
    };

    // Enfocar primer campo editable
    const firstInput = document.querySelector('#clienteEditForm input:not([readonly]):not([type="hidden"]), select');
    firstInput?.focus();

    // Manejar cierre del modal
    const modal = document.getElementById('clienteEditModal');
    modal.addEventListener('hide.bs.modal', clearErrors);
    
    // Inicializar validación
    setupRealTimeValidation();

    // Formatear teléfono
    document.getElementById('{{ form.telefono.id_for_label }}').addEventListener('input', function(e) {
        this.value = this.value.replace(/[^0-9]/g, '')
            .replace(/(\d{3})(\d{3})(\d{4})/, '($1) $2-$3');
    });

    // Formatear móvil
    document.getElementById('{{ form.movil.id_for_label }}').addEventListener('input', function(e) {
        this.value = this.value.replace(/[^0-9]/g, '')
            .replace(/(\d{3})(\d{3})(\d{4})/, '($1) $2-$3');
    });
});
</script>