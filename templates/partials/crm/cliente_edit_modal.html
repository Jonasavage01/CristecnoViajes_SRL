{% load static %}
<div class="modal fade" id="clienteEditModal" tabindex="-1" aria-labelledby="clienteEditModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dark">
        <div class="modal-content bg-dark">
            <!-- Contenedor para cargar el formulario dinámicamente -->
            <div id="formContainer"></div>
        </div>
    </div>
</div>

<!-- CSS y scripts globales -->
<link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="{% static 'crm/formValidation.js' %}"></script>

<script type="module">
    import { showErrorAlert, showSuccessAlert } from "{% static 'crm/alerts.js' %}";
    
    document.getElementById('clienteEditModal').addEventListener('shown.bs.modal', function(event) {
        const button = event.relatedTarget;
        const formContainer = this.querySelector('#formContainer');
        const editUrl = button.getAttribute('data-url');
        
        fetch(editUrl, {
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.text())
        .then(html => {
            formContainer.innerHTML = html;
            const form = formContainer.querySelector('form');
            if (form) {
                form.action = editUrl;
                form.addEventListener('submit', handleFormSubmit);
                setupRealTimeValidation();
            }
        })
        .catch(error => {
            console.error('Error loading form:', error);
            showErrorAlert('Error al cargar el formulario de edición');
        });
    });
</script>
